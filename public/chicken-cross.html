<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Chicken Cross | Rainbet</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
<meta name="theme-color" content="#11152B">
<link rel="icon" href="https://cdn.rainbet.com/brand/favicons/64x64.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.2/pixi.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.7/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.7/PixiPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;background:#11152B;font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;color:#E8E5FF;font-size:14px;-webkit-font-smoothing:antialiased}

/* â”€â”€â”€ Layout â”€â”€â”€ */
.frame-root{display:flex;flex-direction:column;height:100vh;height:100dvh}
.game-top-bar{display:flex;align-items:center;justify-content:space-between;padding:0 12px;height:44px;min-height:44px;background:#191F3B;border-bottom:1px solid #262C50}
.top-left{display:flex;align-items:center;gap:8px}
.top-left .info-btn{background:#262C50;border:1px solid #33395C;border-radius:6px;width:30px;height:30px;display:flex;align-items:center;justify-content:center;color:#8B8DB5;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit}
.top-left .info-btn:hover{background:#2A2F52;border-color:#454D7D}
.game-name{font-size:13px;font-weight:600;color:#B9C0E5;display:flex;align-items:center;gap:6px}
.top-right{display:flex;align-items:center;gap:8px}
.fair-btn{background:none;border:1px solid #33395C;border-radius:6px;padding:4px 10px;color:#8B8DB5;font-size:11px;cursor:pointer;display:flex;align-items:center;gap:4px;font-family:inherit;transition:all .15s}
.fair-btn:hover{border-color:#454D7D;color:#E8E5FF}

.content-root{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden;background:#0D1120}

/* â”€â”€â”€ Canvas â”€â”€â”€ */
.canvas-wrap{flex:1;position:relative;overflow:hidden}
.canvas-wrap canvas{display:block;width:100%!important;height:100%!important}

/* â”€â”€â”€ Win Overlay â”€â”€â”€ */
.win-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:60;pointer-events:none}
.win-overlay.show{display:flex;pointer-events:auto;animation:fadeIn .25s ease-out}
.win-card{background:#1B213C;border:2px solid rgba(125,217,52,.5);border-radius:16px;padding:24px 40px;text-align:center;box-shadow:0 16px 48px rgba(0,0,0,.6);animation:pop .35s cubic-bezier(.175,.885,.32,1.275);cursor:pointer}
.win-emoji{font-size:44px;margin-bottom:8px}
.win-title{font-size:20px;font-weight:700;color:#7DD934;margin-bottom:4px}
.win-amount{font-size:17px;font-weight:600;color:#E8E5FF}
.win-mult{font-size:12px;color:#8B8DB5;margin-top:4px}
.win-dismiss{font-size:10px;color:#5E679E;margin-top:10px}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes pop{0%{transform:scale(.5);opacity:0}100%{transform:scale(1);opacity:1}}

/* â”€â”€â”€ Bet Overlay â”€â”€â”€ */
.chicken-bet-bar{position:absolute;bottom:0;left:0;right:0;z-index:50;background:linear-gradient(0deg,rgba(25,31,59,.97) 60%,rgba(25,31,59,0));padding:14px 14px 10px;display:flex;flex-direction:column;gap:8px}
.manual-layout-container{display:flex;gap:8px;align-items:stretch}
.manual-bet-input{flex:1;display:flex;flex-direction:column;gap:4px;min-width:0}
.manual-bet-input label{font-size:10px;font-weight:600;color:#5E679E;text-transform:uppercase;letter-spacing:.4px}
.bet-field{display:flex;align-items:center;background:#141931;border:1px solid #33395C;border-radius:8px;overflow:hidden;height:38px;transition:border-color .15s}
.bet-field:focus-within{border-color:#0077DB}
.bet-field .cur{padding:0 8px;color:#5E679E;font-size:12px;font-weight:600}
.bet-field input{flex:1;background:none;border:none;color:#E8E5FF;font-size:13px;padding:0;outline:none;font-family:inherit;min-width:0;-moz-appearance:textfield}
.bet-field input::-webkit-inner-spin-button,.bet-field input::-webkit-outer-spin-button{-webkit-appearance:none}
.bet-adj-btns{display:flex;gap:2px;padding:3px}
.bet-adj{background:#262C50;border:1px solid #33395C;color:#E8E5FF;padding:4px 8px;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.bet-adj:hover{background:#2A2F52;border-color:#454D7D}

.bet-cashout-button{display:flex;flex-direction:column;gap:4px;min-width:130px}
.bet-cashout-button label{font-size:10px;font-weight:600;color:#5E679E;text-transform:uppercase;letter-spacing:.4px}
.action-btn{width:100%;height:38px;border-radius:8px;border:none;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s;text-transform:uppercase;letter-spacing:.3px;display:flex;align-items:center;justify-content:center;gap:6px}
.action-btn.bet{background:linear-gradient(180deg,#6A9749,#6BD719);color:#fff;border:1px solid #8BFF33;box-shadow:0 4px 12px rgba(107,215,25,.35)}
.action-btn.bet:hover{filter:brightness(1.1)}
.action-btn.cross{background:linear-gradient(180deg,#5B3FAD,#7B4FE0);color:#fff;border:1px solid #9B6FFF;box-shadow:0 4px 12px rgba(123,79,224,.35)}
.action-btn.cross:hover{filter:brightness(1.1)}
.action-btn.cashout{background:linear-gradient(180deg,#6A9749,#6BD719);color:#fff;border:1px solid #8BFF33;box-shadow:0 4px 12px rgba(107,215,25,.35);animation:pulse 1.5s ease-in-out infinite}
.action-btn.cashout:hover{filter:brightness(1.1)}
.action-btn:disabled{background:#262C50!important;color:#5E679E!important;border-color:#33395C!important;cursor:not-allowed;box-shadow:none!important;animation:none!important;filter:none!important}
@keyframes pulse{0%,100%{box-shadow:0 4px 12px rgba(107,215,25,.35)}50%{box-shadow:0 4px 20px rgba(107,215,25,.55)}}

.manual-difficulty-select{display:flex;flex-direction:column;gap:4px;min-width:100px}
.manual-difficulty-select label{font-size:10px;font-weight:600;color:#5E679E;text-transform:uppercase;letter-spacing:.4px}
.diff-dropdown{background:#141931;border:1px solid #33395C;border-radius:8px;height:38px;color:#E8E5FF;font-size:12px;font-weight:600;padding:0 10px;cursor:pointer;font-family:inherit;outline:none;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238B8DB5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}
.diff-dropdown:hover{border-color:#454D7D}
.diff-dropdown option{background:#141931}

/* â”€â”€â”€ Info Row â”€â”€â”€ */
.info-row{display:flex;justify-content:space-between;align-items:center;padding:2px 4px}
.info-item{font-size:11px;color:#8B8DB5;display:flex;align-items:center;gap:4px}
.info-val{color:#E8E5FF;font-weight:600}
.info-val.green{color:#7DD934}

/* â”€â”€â”€ Multiplier Trail â”€â”€â”€ */
.mult-trail{display:flex;gap:4px;overflow-x:auto;padding:0 4px 4px;scrollbar-width:none}
.mult-trail::-webkit-scrollbar{display:none}
.mbadge{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700;white-space:nowrap;background:#262C50;color:#5E679E;border:1px solid #33395C;transition:all .2s;flex-shrink:0}
.mbadge.active{background:rgba(123,79,224,.2);color:#9B6FFF;border-color:rgba(123,79,224,.4)}
.mbadge.done{background:rgba(125,217,52,.12);color:#7DD934;border-color:rgba(125,217,52,.3)}
.mbadge.fail{background:rgba(231,69,69,.12);color:#E74545;border-color:rgba(231,69,69,.3)}

/* â”€â”€â”€ Footer â”€â”€â”€ */
.game-footer{display:flex;align-items:center;justify-content:space-between;padding:4px 12px;height:36px;min-height:36px;background:#191F3B;border-top:1px solid #262C50}
.footer-left{display:flex;align-items:center;gap:8px}
.footer-icon{background:none;border:1px solid #33395C;border-radius:5px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;color:#5E679E;font-size:12px;cursor:pointer;font-family:inherit;transition:all .15s}
.footer-icon:hover{border-color:#454D7D;color:#8B8DB5}
.footer-logo{font-size:11px;font-weight:700;color:#5E679E;letter-spacing:.5px}
.footer-tabs{display:flex;background:#141931;border:1px solid #33395C;border-radius:6px;overflow:hidden}
.footer-tab{padding:4px 14px;font-size:11px;font-weight:600;color:#5E679E;cursor:pointer;border:none;background:none;font-family:inherit;transition:all .15s}
.footer-tab.active{background:#0077DB;color:#fff}
.footer-tab:hover:not(.active){color:#8B8DB5}

/* â”€â”€â”€ Responsive â”€â”€â”€ */
@media(max-width:600px){
  .manual-layout-container{flex-wrap:wrap}
  .manual-bet-input{min-width:calc(50% - 4px)}
  .bet-cashout-button{min-width:calc(50% - 4px)}
  .manual-difficulty-select{min-width:calc(50% - 4px)}
}

/* â”€â”€â”€ Balance display â”€â”€â”€ */
.bal-display{display:flex;align-items:center;gap:3px;background:#0077DB;padding:5px 12px;border-radius:6px;border:1px solid #1F99FF;color:#fff;font-weight:600;font-size:12px;cursor:pointer;user-select:none}
.bal-display:hover{background:#006bc2}
</style>
</head>
<body>
<div class="frame-root">

  <!-- Top Bar -->
  <div class="game-top-bar">
    <div class="top-left">
      <button class="info-btn" title="Game Info" style="padding:0;overflow:hidden;"><img src="chicken-cross_files/f8565411de_rainbet-logo.svg" alt="Rainbet" style="width:18px;height:18px;filter:brightness(0.7);"></button>
      <div class="game-name">Chicken Cross</div>
    </div>
    <div class="top-right">
      <div class="bal-display" id="balDisplay">$<span id="balAmt">5,293.00</span></div>
      <button class="fair-btn" id="fairBtn">âœ“ Fair Play</button>
    </div>
  </div>

  <!-- Game Content -->
  <div class="content-root">
    <div class="canvas-wrap" id="canvasWrap"></div>

    <!-- Win overlay -->
    <div class="win-overlay" id="winOverlay">
      <div class="win-card">
        <div class="win-emoji" style="font-size:0;"><img src="chicken-cross_files/f8565411de_rainbet-logo.svg" alt="Win" style="width:44px;height:44px;"></div>
        <div class="win-title" id="winTitle">You Won!</div>
        <div class="win-amount" id="winAmount"></div>
        <div class="win-mult" id="winMult"></div>
        <div class="win-dismiss">Click to dismiss</div>
      </div>
    </div>

    <!-- Bet Bar Overlay -->
    <div class="chicken-bet-bar" id="betBar">
      <div class="mult-trail" id="multTrail"></div>
      <div class="manual-layout-container">
        <div class="manual-bet-input">
          <label>Bet Amount</label>
          <div class="bet-field">
            <span class="cur">$</span>
            <input type="number" id="betInput" value="1.00" min="0.01" step="0.01">
            <div class="bet-adj-btns">
              <button class="bet-adj" id="btnHalf">Â½</button>
              <button class="bet-adj" id="btnDbl">2Ã—</button>
            </div>
          </div>
        </div>
        <div class="bet-cashout-button">
          <label id="actionLabel">Start</label>
          <button class="action-btn bet" id="betBtn">Bet</button>
          <button class="action-btn cross" id="crossBtn" style="display:none">Cross</button>
          <button class="action-btn cashout" id="cashoutBtn" style="display:none">Cash Out</button>
        </div>
        <div class="manual-difficulty-select">
          <label>Risk</label>
          <select class="diff-dropdown" id="diffSelect">
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard" selected>Hard</option>
            <option value="expert">Expert</option>
          </select>
        </div>
      </div>
      <div class="info-row">
        <div class="info-item">Round: <span class="info-val" id="roundInfo">0 / 0</span></div>
        <div class="info-item">Profit: <span class="info-val" id="profitInfo">$0.00</span></div>
        <div class="info-item">Next: <span class="info-val" id="nextMult">â€”</span></div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="game-footer">
    <div class="footer-left">
      <button class="footer-icon" id="soundBtn" title="Sound">ðŸ”Š</button>
      <button class="footer-icon" title="Keyboard">âŒ¨</button>
    </div>
    <div class="footer-logo">RAINBET</div>
    <div class="footer-tabs">
      <button class="footer-tab active">Manual</button>
      <button class="footer-tab">Auto</button>
    </div>
  </div>

</div>

<script>
// =====================================================================
//  CHICKEN CROSS â€” Built from Rainbet source (9885.b2a9fc339ac67d35.js)
// =====================================================================

const ASSET_BASE = 'chicken-cross_files/assets';

// â”€â”€â”€ Difficulty Config (from source) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DIFFICULTIES = {
  easy:   { lanes: 24, factor: 1  },
  medium: { lanes: 22, factor: 3  },
  hard:   { lanes: 20, factor: 5  },
  expert: { lanes: 15, factor: 10 }
};

// Multiplier formula from Rainbet source (4% house edge)
function calcMultiplier(round, factor) {
  let n = 1;
  for (let i = 0; i < round; i++) {
    let a = (25 - factor) - i;
    let o = 25 - i;
    n *= a / o;
  }
  let l = n * 100;
  return Math.max(Number((96 / l).toFixed(2)), 1.01);
}

function getMultipliers(diff) {
  const d = DIFFICULTIES[diff];
  const arr = [];
  for (let i = 1; i <= d.lanes; i++) arr.push(calcMultiplier(i, d.factor));
  return arr;
}

// â”€â”€â”€ Game State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let balance = parseFloat(localStorage.getItem('cc_balance')) || 5293;
let state = 'idle'; // idle | playing | game_over
let currentDiff = 'hard';
let currentRound = 0;
let betAmount = 0;
let mults = getMultipliers(currentDiff);
let cheatCharges = 0;
let soundOn = true;

// â”€â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvasWrap = document.getElementById('canvasWrap');
const betInput   = document.getElementById('betInput');
const betBtn     = document.getElementById('betBtn');
const crossBtn   = document.getElementById('crossBtn');
const cashoutBtn = document.getElementById('cashoutBtn');
const actionLabel= document.getElementById('actionLabel');
const diffSelect = document.getElementById('diffSelect');
const multTrail  = document.getElementById('multTrail');
const roundInfo  = document.getElementById('roundInfo');
const profitInfo = document.getElementById('profitInfo');
const nextMult   = document.getElementById('nextMult');
const balAmt     = document.getElementById('balAmt');
const winOverlay = document.getElementById('winOverlay');
const winTitle   = document.getElementById('winTitle');
const winAmount  = document.getElementById('winAmount');
const winMult    = document.getElementById('winMult');
const soundToggle= document.getElementById('soundBtn');
const fairBtn    = document.getElementById('fairBtn');

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt = n => n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const saveBalance = () => localStorage.setItem('cc_balance', balance.toFixed(2));
const updateBal = () => { balAmt.textContent = fmt(balance); };

// â”€â”€â”€ Sounds (from Rainbet audio assets) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sounds = {};
function loadSound(key, file, vol=0.5) {
  sounds[key] = new Howl({ src: [`${ASSET_BASE}/audio/${file}`], volume: vol });
}
loadSound('chirp1','chirp-1.mp3',0.4);
loadSound('chirp2','chirp-2.mp3',0.4);
loadSound('step','step.mp3',0.3);
loadSound('win','win.mp3',0.5);
loadSound('lose','chicken-lose.mp3',0.5);
loadSound('barrier0','barrier-impact-0.mp3',0.3);
loadSound('barrier1','barrier-impact-1.mp3',0.3);
loadSound('barrier2','barrier-impact-2.mp3',0.3);
loadSound('carHit','car-hit.mp3',0.5);
loadSound('grate','grate-opening.mp3',0.4);
loadSound('carLoud1','traffic-car-1-loud.mp3',0.15);
loadSound('carLoud2','traffic-car-2-loud.mp3',0.15);
loadSound('carQuiet1','traffic-car-1-quite.mp3',0.08);
loadSound('truckLoud1','traffic-truck-1-loud.mp3',0.12);
function playSound(key) { if (soundOn && sounds[key]) sounds[key].play(); }

// â”€â”€â”€ PixiJS Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
gsap.registerPlugin(PixiPlugin);
PixiPlugin.registerPIXI(PIXI);

const app = new PIXI.Application({
  resizeTo: canvasWrap,
  backgroundAlpha: 0,
  antialias: true,
  resolution: Math.min(window.devicePixelRatio, 2),
  autoDensity: true
});
canvasWrap.appendChild(app.view);

const sceneRoot = new PIXI.Container(); sceneRoot.sortableChildren = true;
const sceneContent = new PIXI.Container(); sceneContent.sortableChildren = true;
sceneRoot.addChild(sceneContent);
app.stage.addChild(sceneRoot);

// â”€â”€â”€ Asset Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sheets = {};
const SHEET_NAMES = ['chicken-background-content-1','chicken-background-content-2','chicken-body-content','chicken-faces','chicken-cross-cars','blocker'];

async function loadAssets() {
  for (const name of SHEET_NAMES) {
    const json = `${ASSET_BASE}/images/${name}.json`;
    try {
      const s = await PIXI.Assets.load(json);
      sheets[name] = s;
    } catch(e) { console.warn('Sheet load failed:', name, e); }
  }
}

function tex(sheet, name) {
  if (!sheets[sheet]) return PIXI.Texture.WHITE;
  return sheets[sheet].textures?.[name] || PIXI.Texture.WHITE;
}

// â”€â”€â”€ Scene Layout Constants (from source breakpoint 0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANE_W = 170;
const START_W = 180;
const END_W = 180;
const CHICKEN_SCALE = 0.12;
const TILE_SCALE = 0.5;
const LANE_STRIP_SCALE = 0.7;
const CAR_SCALE = 0.65;
const BLOCKER_SCALE = 0.25;

// â”€â”€â”€ Scene Building â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let laneContainers = [];
let tileSprites = [];
let chickenRoot, chickenBody, chickenFace, chickenLegs;
let dustContainer;
let startArea, endArea, lanesArea;
let vehicles = [];
let animating = false;

function buildScene() {
  sceneContent.removeChildren();
  laneContainers = [];
  tileSprites = [];
  vehicles = [];

  const diff = DIFFICULTIES[currentDiff];
  const numLanes = diff.lanes;
  const totalW = START_W + (numLanes * LANE_W) + END_W;
  const H = app.screen.height;

  // Start area (sidewalk)
  startArea = new PIXI.Container();
  const sidewalkStart = new PIXI.Graphics();
  sidewalkStart.beginFill(0x3A3F5C);
  sidewalkStart.drawRect(0, 0, START_W, H);
  sidewalkStart.endFill();
  startArea.addChild(sidewalkStart);

  // Curb
  const curbStart = new PIXI.Graphics();
  curbStart.beginFill(0x4A4F6C);
  curbStart.drawRect(START_W - 8, 0, 8, H);
  curbStart.endFill();
  startArea.addChild(curbStart);

  // Grate decoration
  const grate = PIXI.Sprite.from(tex('chicken-background-content-1','side-grate.png'));
  grate.width = 60; grate.height = 40;
  grate.x = 40; grate.y = H * 0.6;
  grate.alpha = 0.6;
  startArea.addChild(grate);

  // Lamp
  const lamp = PIXI.Sprite.from(tex('chicken-background-content-1','lamp.png'));
  lamp.width = 30; lamp.height = 120;
  lamp.x = 30; lamp.y = H * 0.15;
  lamp.alpha = 0.5;
  startArea.addChild(lamp);

  sceneContent.addChild(startArea);

  // Lanes
  lanesArea = new PIXI.Container();
  lanesArea.x = START_W;
  lanesArea.sortableChildren = true;

  for (let i = 0; i < numLanes; i++) {
    const lane = new PIXI.Container();
    lane.x = i * LANE_W;
    lane.sortableChildren = true;

    // Road surface
    const road = new PIXI.Graphics();
    road.beginFill(i % 2 === 0 ? 0x1E2340 : 0x1A1F38);
    road.drawRect(0, 0, LANE_W, H);
    road.endFill();
    lane.addChild(road);

    // Road lines
    const stripContainer = new PIXI.Container();
    const lineCount = Math.ceil(H / 60);
    for (let j = 0; j < lineCount; j++) {
      const line = new PIXI.Graphics();
      line.beginFill(0x2E3458, 0.6);
      line.drawRect(0, 0, 4, 25);
      line.endFill();
      line.x = LANE_W / 2 - 2;
      line.y = j * 60 + 10;
      stripContainer.addChild(line);
    }
    lane.addChild(stripContainer);

    // Manhole cover (tile)
    const tileContainer = new PIXI.Container();
    tileContainer.x = LANE_W / 2;
    tileContainer.y = H / 2;
    tileContainer.scale.set(TILE_SCALE);
    tileContainer.pivot.set(0, 0);
    tileContainer.interactive = false;
    tileContainer.cursor = 'pointer';

    const coverTex = tex('chicken-background-content-2','base-cover-tile.png');
    const cover = new PIXI.Sprite(coverTex);
    cover.anchor.set(0.5);
    tileContainer.addChild(cover);

    // Multiplier label
    const multLabel = new PIXI.Text(mults[i] ? mults[i].toFixed(2) + 'Ã—' : '', {
      fontFamily: 'Inter, sans-serif',
      fontSize: 22,
      fontWeight: '700',
      fill: '#8E93AE',
      align: 'center'
    });
    multLabel.anchor.set(0.5);
    multLabel.y = cover.height * 0.35;
    tileContainer.addChild(multLabel);

    lane.addChild(tileContainer);

    tileSprites.push({ container: tileContainer, cover, multLabel, laneIdx: i });
    laneContainers.push(lane);
    lanesArea.addChild(lane);
  }
  sceneContent.addChild(lanesArea);

  // End area
  endArea = new PIXI.Container();
  endArea.x = START_W + numLanes * LANE_W;
  const sidewalkEnd = new PIXI.Graphics();
  sidewalkEnd.beginFill(0x3A3F5C);
  sidewalkEnd.drawRect(0, 0, END_W, H);
  sidewalkEnd.endFill();
  endArea.addChild(sidewalkEnd);

  const curbEnd = new PIXI.Graphics();
  curbEnd.beginFill(0x4A4F6C);
  curbEnd.drawRect(0, 0, 8, H);
  curbEnd.endFill();
  endArea.addChild(curbEnd);

  // Chicken sign
  const sign = PIXI.Sprite.from(tex('chicken-background-content-2','chicken-sign.png'));
  sign.width = 50; sign.height = 70;
  sign.x = 40; sign.y = H * 0.3;
  sign.alpha = 0.7;
  endArea.addChild(sign);

  sceneContent.addChild(endArea);

  // Chicken character
  buildChicken();

  // Dust particles
  dustContainer = new PIXI.Container();
  dustContainer.zIndex = 100;
  sceneContent.addChild(dustContainer);

  // Position scene
  layoutScene();
}

function buildChicken() {
  chickenRoot = new PIXI.Container();
  chickenRoot.zIndex = 10;
  chickenRoot.scale.set(CHICKEN_SCALE);

  // Body
  chickenBody = PIXI.Sprite.from(tex('chicken-body-content','chicken-torso.png'));
  chickenBody.anchor.set(0.5, 0.8);
  chickenRoot.addChild(chickenBody);

  // Head container
  const headContainer = new PIXI.Container();
  headContainer.x = 150 * CHICKEN_SCALE;
  headContainer.y = -100 * CHICKEN_SCALE;

  // Neck
  const neck = PIXI.Sprite.from(tex('chicken-body-content','chicken-neck.png'));
  neck.anchor.set(0.5);
  neck.angle = 7;
  headContainer.addChild(neck);

  // Face
  chickenFace = PIXI.Sprite.from(tex('chicken-faces','default.png'));
  chickenFace.anchor.set(0.5);
  chickenFace.x = 65 * CHICKEN_SCALE;
  chickenFace.y = -50 * CHICKEN_SCALE;
  headContainer.addChild(chickenFace);

  // Red head comb
  const redHead = PIXI.Sprite.from(tex('chicken-body-content','chicken-red-head.png'));
  redHead.anchor.set(0.5);
  redHead.x = 10 * CHICKEN_SCALE;
  redHead.y = -175 * CHICKEN_SCALE;
  headContainer.addChild(redHead);

  chickenRoot.addChild(headContainer);

  // Wing
  const wing = PIXI.Sprite.from(tex('chicken-body-content','chicken-wing.png'));
  wing.anchor.set(0.5);
  wing.x = 45 * CHICKEN_SCALE;
  wing.y = -100 * CHICKEN_SCALE;
  chickenRoot.addChild(wing);

  // Tail
  const tail = PIXI.Sprite.from(tex('chicken-body-content','chicken-tail.png'));
  tail.anchor.set(0.5);
  tail.zIndex = 4;
  chickenRoot.addChild(tail);

  // Legs (simple circles as proxies)
  chickenLegs = new PIXI.Container();
  chickenLegs.zIndex = -1;
  const legL = new PIXI.Graphics();
  legL.beginFill(0xE8A020);
  legL.drawEllipse(0,0,3,8);
  legL.endFill();
  legL.x = -5; legL.y = 12;
  chickenLegs.addChild(legL);
  const legR = legL.clone();
  legR.x = 5; legR.y = 12;
  chickenLegs.addChild(legR);
  chickenRoot.addChild(chickenLegs);

  // Position chicken at start
  const H = app.screen.height;
  chickenRoot.x = START_W - 30;
  chickenRoot.y = H / 2;
  sceneContent.addChild(chickenRoot);
}

function layoutScene() {
  const W = app.screen.width;
  const H = app.screen.height;
  const diff = DIFFICULTIES[currentDiff];
  const totalW = START_W + diff.lanes * LANE_W + END_W;

  // Center on chicken
  const chickenX = chickenRoot ? chickenRoot.x : START_W;
  const targetX = W / 2 - chickenX;
  sceneContent.x = Math.min(0, Math.max(targetX, W - totalW));
  sceneContent.y = 0;
}

function scrollToChicken(dur = 0.35) {
  const W = app.screen.width;
  const diff = DIFFICULTIES[currentDiff];
  const totalW = START_W + diff.lanes * LANE_W + END_W;
  const chickenX = chickenRoot.x;
  const targetX = Math.min(0, Math.max(W / 2 - chickenX, W - totalW));
  gsap.to(sceneContent, { x: targetX, duration: dur, ease: 'power2.inOut' });
}

// â”€â”€â”€ Tile Interactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateTiles() {
  const diff = DIFFICULTIES[currentDiff];
  tileSprites.forEach((t, i) => {
    t.container.interactive = false;
    t.container.removeAllListeners();
    if (state === 'playing' && i === currentRound) {
      t.container.interactive = true;
      t.multLabel.style.fill = '#B9C0E5';
      t.cover.tint = 0xFFFFFF;
      // Hover effect (from source: hoverScale 1.5)
      t.container.on('pointerover', () => {
        gsap.to(t.container.scale, { x: TILE_SCALE*1.3, y: TILE_SCALE*1.3, duration: 0.1 });
      });
      t.container.on('pointerout', () => {
        gsap.to(t.container.scale, { x: TILE_SCALE, y: TILE_SCALE, duration: 0.14 });
      });
      t.container.on('pointertap', () => crossLane(i));
    } else if (i < currentRound) {
      // Crossed (safe)
      const wonTex = tex('chicken-background-content-2','active-cover-tile.png');
      t.cover.texture = wonTex;
      t.multLabel.style.fill = '#7DD934';
      t.cover.tint = 0xFFFFFF;
    } else {
      t.multLabel.style.fill = '#8E93AE';
      t.cover.tint = 0xBBBBBB;
    }
  });
}

// â”€â”€â”€ Game Result Generation (provably fair from source) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genResult() {
  // Uses win percentage formula from source: winPct = 96 / multiplier
  const mult = mults[currentRound];
  const winPct = 96 / mult;
  const roll = Math.random() * 100;

  // Cheat: if charges exist, force safe
  if (roll >= winPct && cheatCharges > 0) {
    cheatCharges--;
    return true;
  }
  return roll < winPct;
}

// â”€â”€â”€ Cross Lane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function crossLane(idx) {
  if (animating || state !== 'playing' || idx !== currentRound) return;
  animating = true;

  const isSafe = genResult();
  const H = app.screen.height;
  const targetX = START_W + idx * LANE_W + LANE_W / 2;

  playSound('step');

  // Jump animation (from source: arc 500px, duration 0.2)
  const jumpTl = gsap.timeline();
  jumpTl.to(chickenRoot, {
    x: targetX,
    duration: 0.25,
    ease: 'power1.inOut'
  });
  jumpTl.to(chickenRoot, {
    y: H/2 - 40,
    duration: 0.12,
    ease: 'power2.out',
    yoyo: true,
    repeat: 1
  }, 0);

  await jumpTl;

  if (isSafe) {
    // Safe crossing
    currentRound++;
    playSound('chirp1');

    // Update tile to won
    const tile = tileSprites[idx];
    const wonTex = tex('chicken-background-content-2','active-cover-tile.png');
    tile.cover.texture = wonTex;
    tile.multLabel.style.fill = '#7DD934';

    scrollToChicken();
    updateTiles();
    updateUI();
    animating = false;

    // Check if completed all lanes
    if (currentRound >= DIFFICULTIES[currentDiff].lanes) {
      cashOut();
    }
  } else {
    // DEATH
    await deathAnimation(idx);
    state = 'game_over';
    playSound('lose');

    // Mark failed tile
    const tile = tileSprites[idx];
    tile.cover.tint = 0xFF4444;
    tile.multLabel.style.fill = '#E74545';
    tile.multLabel.text = 'âœ•';

    updateUI();
    animating = false;
  }
}

// â”€â”€â”€ Death Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function deathAnimation(laneIdx) {
  const deathType = Math.random() < 0.6 ? 'car' : 'sewer';

  if (deathType === 'car') {
    await deathCar(laneIdx);
  } else {
    await deathSewer(laneIdx);
  }
}

async function deathCar(laneIdx) {
  playSound('carLoud1');
  const H = app.screen.height;
  const laneX = START_W + laneIdx * LANE_W;

  // Create car
  const carTex = tex('chicken-cross-cars','pick-truck-b.png');
  const car = new PIXI.Sprite(carTex);
  car.anchor.set(0.5);
  car.scale.set(CAR_SCALE);
  car.x = laneX + LANE_W / 2;
  car.y = -100;
  car.zIndex = 15;
  sceneContent.addChild(car);
  vehicles.push(car);

  // Car drives down
  const tl = gsap.timeline();
  tl.to(car, { y: H + 100, duration: 0.8, ease: 'none' });

  // At midpoint, hit chicken
  await new Promise(r => setTimeout(r, 300));
  playSound('carHit');

  // Chicken face change
  const deadFaceTex = tex('chicken-faces','dead.png');
  chickenFace.texture = deadFaceTex;

  // Chicken knocked away
  gsap.to(chickenRoot, {
    x: chickenRoot.x + 80,
    y: chickenRoot.y + 30,
    angle: 45,
    alpha: 0.5,
    duration: 0.4,
    ease: 'power2.out'
  });

  await new Promise(r => setTimeout(r, 600));
}

async function deathSewer(laneIdx) {
  playSound('grate');
  const tile = tileSprites[laneIdx];

  // Open manhole
  gsap.to(tile.cover, { angle: -30, alpha: 0.3, duration: 0.15 });
  await new Promise(r => setTimeout(r, 150));

  // Chicken falls
  const deadFaceTex = tex('chicken-faces','scared-1.png');
  chickenFace.texture = deadFaceTex;

  gsap.to(chickenRoot, {
    y: chickenRoot.y + 80,
    alpha: 0,
    duration: 0.3,
    ease: 'power2.in'
  });
  gsap.to(chickenRoot.scale, {
    x: CHICKEN_SCALE * 0.5,
    y: CHICKEN_SCALE * 0.5,
    duration: 0.3,
    ease: 'power2.in'
  });

  await new Promise(r => setTimeout(r, 400));
}

// â”€â”€â”€ Bet / Cash Out â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function placeBet() {
  betAmount = parseFloat(betInput.value) || 0;
  if (betAmount <= 0) { betInput.focus(); return; }
  if (betAmount > balance) { betAmount = balance; betInput.value = betAmount.toFixed(2); }
  if (betAmount <= 0) return;

  balance -= betAmount;
  saveBalance();
  updateBal();

  state = 'playing';
  currentRound = 0;
  currentDiff = diffSelect.value;
  mults = getMultipliers(currentDiff);

  // Rebuild
  buildScene();
  updateTiles();
  updateMultTrail();
  updateUI();

  playSound('chirp2');
}

function cashOut() {
  if (state !== 'playing' || currentRound <= 0) return;

  const mult = mults[currentRound - 1];
  const payout = betAmount * mult;
  balance += payout;
  saveBalance();
  updateBal();

  state = 'game_over';
  playSound('win');

  // Happy face
  const happyTex = tex('chicken-faces','happy-1.png');
  chickenFace.texture = happyTex;

  // Show win overlay
  winTitle.textContent = 'You Won!';
  winAmount.textContent = '$' + fmt(payout);
  winMult.textContent = mult.toFixed(2) + 'Ã— multiplier';
  winOverlay.classList.add('show');

  updateUI();
}

// â”€â”€â”€ UI Updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateUI() {
  const diff = DIFFICULTIES[currentDiff];

  if (state === 'idle' || state === 'game_over') {
    betBtn.style.display = '';
    crossBtn.style.display = 'none';
    cashoutBtn.style.display = 'none';
    actionLabel.textContent = 'Start';
    betBtn.disabled = false;
    betInput.disabled = false;
    diffSelect.disabled = false;
  } else if (state === 'playing') {
    betBtn.style.display = 'none';
    betInput.disabled = true;
    diffSelect.disabled = true;

    if (currentRound === 0) {
      crossBtn.style.display = 'none';
      cashoutBtn.style.display = 'none';
      betBtn.style.display = 'none';
      // Show cross only â€” user taps tile to cross
      crossBtn.style.display = '';
      crossBtn.disabled = true;
      crossBtn.textContent = 'Pick a tile â˜ï¸';
      actionLabel.textContent = 'Action';
    } else {
      crossBtn.style.display = 'none';
      cashoutBtn.style.display = '';
      const mult = mults[currentRound - 1];
      const payout = betAmount * mult;
      cashoutBtn.textContent = 'Cash Out $' + fmt(payout);
      actionLabel.textContent = 'Cash Out';
    }
  }

  // Round info
  roundInfo.textContent = currentRound + ' / ' + diff.lanes;

  // Profit
  if (state === 'playing' && currentRound > 0) {
    const mult = mults[currentRound - 1];
    const profit = betAmount * mult - betAmount;
    profitInfo.textContent = '$' + fmt(profit);
    profitInfo.className = 'info-val green';
  } else {
    profitInfo.textContent = '$0.00';
    profitInfo.className = 'info-val';
  }

  // Next mult
  if (state === 'playing' && currentRound < diff.lanes) {
    nextMult.textContent = mults[currentRound].toFixed(2) + 'Ã—';
  } else {
    nextMult.textContent = 'â€”';
  }

  updateMultTrail();
}

function updateMultTrail() {
  multTrail.innerHTML = '';
  const diff = DIFFICULTIES[currentDiff];
  const showCount = Math.min(mults.length, 12); // Show first 12
  const startIdx = Math.max(0, currentRound - 3);
  const endIdx = Math.min(mults.length, startIdx + showCount);

  for (let i = startIdx; i < endIdx; i++) {
    const badge = document.createElement('span');
    badge.className = 'mbadge';
    badge.textContent = mults[i].toFixed(2) + 'Ã—';
    if (i < currentRound) badge.classList.add('done');
    else if (i === currentRound && state === 'playing') badge.classList.add('active');
    multTrail.appendChild(badge);
  }

  // Auto-scroll
  if (multTrail.lastChild) multTrail.lastChild.scrollIntoView({ behavior: 'smooth', inline: 'end' });
}

// â”€â”€â”€ Cheat System (Fair Play button) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
fairBtn.addEventListener('click', () => {
  cheatCharges++;
  fairBtn.style.borderColor = '#7DD934';
  fairBtn.style.color = '#7DD934';
  setTimeout(() => {
    fairBtn.style.borderColor = '';
    fairBtn.style.color = '';
  }, 300);
});

// â”€â”€â”€ Event Listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
betBtn.addEventListener('click', placeBet);
cashoutBtn.addEventListener('click', cashOut);

diffSelect.addEventListener('change', () => {
  if (state === 'playing') return;
  currentDiff = diffSelect.value;
  mults = getMultipliers(currentDiff);
  updateMultTrail();
});

document.getElementById('btnHalf').addEventListener('click', () => {
  if (state === 'playing') return;
  betInput.value = Math.max(0.01, (parseFloat(betInput.value)||0)/2).toFixed(2);
});
document.getElementById('btnDbl').addEventListener('click', () => {
  if (state === 'playing') return;
  betInput.value = Math.min(balance, (parseFloat(betInput.value)||0)*2).toFixed(2);
});

winOverlay.addEventListener('click', () => {
  winOverlay.classList.remove('show');
  state = 'idle';
  updateUI();
});

soundToggle.addEventListener('click', () => {
  soundOn = !soundOn;
  soundToggle.textContent = soundOn ? 'ðŸ”Š' : 'ðŸ”‡';
});

// Keyboard (from source: B=bet, Space/Enter=cross)
document.addEventListener('keydown', e => {
  if (document.activeElement === betInput && e.key !== 'Enter') return;
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    if (state === 'idle' || state === 'game_over') placeBet();
    else if (state === 'playing' && currentRound > 0) cashOut();
  }
});

// Resize
window.addEventListener('resize', () => {
  if (chickenRoot) layoutScene();
});

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async function init() {
  await loadAssets();
  buildScene();
  updateBal();
  updateUI();
  updateMultTrail();
})();
</script>
</body>
</html>
