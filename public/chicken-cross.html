<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Chicken Cross ‚Äì Rainbet</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
<meta name="theme-color" content="#11152B">
<link rel="icon" href="https://cdn.rainbet.com/brand/favicons/64x64.png">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;background:#11152B;color:#E8E5FF;
  font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  -webkit-font-smoothing:antialiased}

.app{display:flex;flex-direction:column;height:100vh;height:100dvh}

/* ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ */
.top-bar{display:flex;align-items:center;justify-content:space-between;
  height:42px;min-height:42px;padding:0 14px;background:#191F3B;border-bottom:1px solid #262C50}
.top-left{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:#8B8DB5}
.top-left .icon{width:26px;height:26px;border-radius:50%;background:#262C50;display:flex;
  align-items:center;justify-content:center;font-size:12px;cursor:pointer}
.top-left .title{color:#E8E5FF;font-size:14px;display:flex;align-items:center;gap:5px}
.top-right{display:flex;align-items:center;gap:8px}
.fair-btn{background:none;border:1px solid #33395C;color:#8B8DB5;padding:4px 10px;border-radius:5px;
  font-size:11px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px;
  transition:all .2s;font-family:inherit}
.fair-btn:hover{background:#262C50;color:#E8E5FF}

/* ‚îÄ‚îÄ‚îÄ Game Canvas ‚îÄ‚îÄ‚îÄ */
.game-wrap{flex:1;position:relative;overflow:hidden;background:#1B213C}
.game-canvas{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;
  justify-content:flex-end;padding-bottom:160px;overflow:hidden;position:relative}

/* Road */
.road{width:90%;max-width:500px;position:relative}
.lane{display:flex;align-items:center;justify-content:center;height:52px;position:relative;
  border-bottom:2px dashed rgba(255,255,255,.08);transition:all .3s}
.lane:last-child{border-bottom:none}
.lane-num{position:absolute;left:-28px;font-size:10px;font-weight:700;color:#5E679E;width:22px;text-align:right}
.lane-mult{position:absolute;right:-50px;font-size:11px;font-weight:700;color:#5E679E;white-space:nowrap}
.lane.active{background:rgba(0,119,219,.06);border-color:rgba(0,119,219,.2)}
.lane.cleared{background:rgba(125,217,52,.04)}
.lane.dead{background:rgba(231,69,69,.06)}

/* Tiles inside lane */
.tiles{display:flex;gap:6px}
.tile{width:52px;height:40px;border-radius:8px;border:2px solid #262C50;background:#191F3B;
  display:flex;align-items:center;justify-content:center;font-size:18px;cursor:default;
  transition:all .25s;user-select:none}
.lane.active .tile{border-color:rgba(0,119,219,.5);background:rgba(0,119,219,.08);cursor:pointer;
  animation:tileGlow 2s ease-in-out infinite}
.lane.active .tile:hover{border-color:#0077DB;background:rgba(0,119,219,.15);transform:scale(1.08)}
.tile.safe{border-color:rgba(125,217,52,.5)!important;background:rgba(125,217,52,.1)!important;
  cursor:default!important;animation:none!important}
.tile.safe::after{content:'‚úì';color:#7DD934;font-size:16px;font-weight:700}
.tile.danger{border-color:rgba(231,69,69,.5)!important;background:rgba(231,69,69,.1)!important;
  cursor:default!important;animation:none!important}
.tile.danger::after{content:'üíÄ';font-size:16px}
.tile.pothole{border-color:rgba(231,69,69,.5)!important;background:rgba(231,69,69,.1)!important;
  cursor:default!important;animation:none!important}
.tile.pothole::after{content:'üï≥Ô∏è';font-size:16px}
.tile.revealed{border-color:#262C50!important;background:#191F3B!important;cursor:default!important;animation:none!important;opacity:.4}
@keyframes tileGlow{0%,100%{border-color:rgba(0,119,219,.4)}50%{border-color:rgba(0,119,219,.7)}}

/* Chicken */
.chicken{font-size:32px;margin-bottom:6px;transition:all .4s cubic-bezier(.34,1.56,.64,1);
  filter:drop-shadow(0 2px 8px rgba(0,0,0,.3));position:relative;z-index:10}
.chicken.dead{filter:grayscale(1) drop-shadow(0 2px 8px rgba(231,69,69,.4));transform:rotate(90deg) scale(.8)}

/* Win overlay */
.win-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:50;
  background:rgba(0,0,0,.4);animation:fadeIn .3s}
.win-overlay.show{display:flex}
.win-card{background:#1B213C;border:2px solid rgba(125,217,52,.4);border-radius:16px;padding:30px 50px;
  text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5);animation:pop .4s cubic-bezier(.175,.885,.32,1.275);
  cursor:pointer}
.win-card.lose{border-color:rgba(231,69,69,.4)}
.win-emoji{font-size:48px;margin-bottom:8px}
.win-text{font-size:22px;font-weight:700;color:#7DD934}
.win-card.lose .win-text{color:#E74545}
.win-amount{font-size:17px;color:#E8E5FF;font-weight:600;margin-top:4px}
.win-sub{font-size:10px;color:#5E679E;margin-top:10px}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes pop{0%{transform:scale(.5);opacity:0}100%{transform:scale(1);opacity:1}}

/* ‚îÄ‚îÄ‚îÄ Bet Overlay (bottom of canvas) ‚îÄ‚îÄ‚îÄ */
.bet-overlay{position:absolute;bottom:0;left:0;right:0;padding:10px 14px;
  background:linear-gradient(transparent,rgba(25,31,59,.95) 20%);z-index:20;
  display:flex;flex-direction:column;gap:8px}

.bet-row{display:flex;gap:8px;align-items:stretch}

/* Bet input group */
.bet-grp{flex:1;display:flex;flex-direction:column;gap:3px}
.bet-label{font-size:10px;font-weight:600;color:#5E679E;text-transform:uppercase;letter-spacing:.3px}
.bet-input-wrap{display:flex;align-items:center;background:#141931;border:1px solid #33395C;
  border-radius:7px;overflow:hidden;height:36px}
.bet-input-wrap:focus-within{border-color:#0077DB}
.bet-cur{padding:0 8px;color:#5E679E;font-size:12px;font-weight:600}
.bet-input{flex:1;background:none;border:0;color:#E8E5FF;font-size:13px;padding:0;outline:0;
  font-family:inherit;min-width:0;-moz-appearance:textfield}
.bet-input::-webkit-inner-spin-button,.bet-input::-webkit-outer-spin-button{-webkit-appearance:none}
.bet-adj{background:#262C50;border:none;color:#E8E5FF;padding:4px 8px;font-size:11px;font-weight:700;
  cursor:pointer;transition:all .15s;font-family:inherit;border-left:1px solid #33395C}
.bet-adj:hover{background:#2A2F52}

/* Risk dropdown */
.risk-grp{width:100px;display:flex;flex-direction:column;gap:3px}
.risk-select{height:36px;background:#141931;border:1px solid #33395C;border-radius:7px;color:#E8E5FF;
  font-size:12px;font-weight:600;padding:0 8px;outline:0;font-family:inherit;cursor:pointer;
  -webkit-appearance:none;appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235E679E'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center}

/* Buttons row */
.btn-row{display:flex;gap:8px}
.btn-bet{flex:1;height:40px;border-radius:8px;border:none;font-size:14px;font-weight:700;
  cursor:pointer;font-family:inherit;text-transform:uppercase;letter-spacing:.3px;transition:all .15s;
  background:linear-gradient(180deg,#0077DB,#005aa8);color:#fff;
  box-shadow:0 4px 12px rgba(0,119,219,.4)}
.btn-bet:hover{background:linear-gradient(180deg,#0085f2,#0066be)}
.btn-bet:disabled{background:#262C50!important;color:#5E679E!important;cursor:not-allowed;box-shadow:none!important}

.btn-cross{flex:1;height:40px;border-radius:8px;border:none;font-size:14px;font-weight:700;
  cursor:pointer;font-family:inherit;text-transform:uppercase;letter-spacing:.3px;transition:all .15s;
  background:linear-gradient(180deg,#8B45E6,#6B2FB8);color:#fff;
  box-shadow:0 4px 12px rgba(139,69,230,.4);display:none}
.btn-cross:hover{background:linear-gradient(180deg,#9D5BF0,#7B3CC8)}
.btn-cross:disabled{background:#262C50!important;color:#5E679E!important;cursor:not-allowed;box-shadow:none!important}

.btn-cashout{flex:1;height:40px;border-radius:8px;border:none;font-size:14px;font-weight:700;
  cursor:pointer;font-family:inherit;text-transform:uppercase;letter-spacing:.3px;transition:all .15s;
  background:linear-gradient(180deg,#7DD934,#5BB520);color:#fff;
  box-shadow:0 4px 12px rgba(125,217,52,.4);animation:pulse 1.5s ease-in-out infinite;display:none}
.btn-cashout:hover{background:linear-gradient(180deg,#8ee63f,#68c525)}
@keyframes pulse{0%,100%{box-shadow:0 4px 12px rgba(125,217,52,.4)}50%{box-shadow:0 4px 20px rgba(125,217,52,.6)}}

.info-row{display:flex;justify-content:space-between;align-items:center;padding:0 2px}
.info-item{font-size:11px;color:#5E679E}
.info-val{color:#E8E5FF;font-weight:700}
.info-val.green{color:#7DD934}

/* ‚îÄ‚îÄ‚îÄ Footer ‚îÄ‚îÄ‚îÄ */
.footer{display:flex;align-items:center;justify-content:space-between;height:36px;min-height:36px;
  padding:0 14px;background:#191F3B;border-top:1px solid #262C50}
.footer-left{display:flex;align-items:center;gap:12px}
.footer-icon{width:28px;height:28px;border-radius:6px;background:#262C50;border:1px solid #33395C;
  display:flex;align-items:center;justify-content:center;font-size:13px;cursor:pointer;transition:all .15s}
.footer-icon:hover{background:#2A2F52;border-color:#454D7D}
.footer-brand{font-size:12px;font-weight:700;color:#5E679E;display:flex;align-items:center;gap:4px}
.footer-right{display:flex;gap:4px}
.tab{padding:5px 14px;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;
  background:none;border:1px solid transparent;color:#5E679E;font-family:inherit;transition:all .15s}
.tab.on{background:#262C50;border-color:#33395C;color:#E8E5FF}
.tab:hover{color:#E8E5FF}

/* Balance display */
.bal-display{position:absolute;top:8px;right:14px;background:#0077DB;padding:6px 12px;border-radius:18px;
  border:2px solid #1F99FF;color:#fff;font-weight:700;font-size:13px;z-index:30;
  box-shadow:0 2px 10px rgba(0,0,0,.3);display:flex;align-items:center;gap:4px;cursor:pointer}
.bal-display:hover{background:#0069c4}
.bal-display .cur{opacity:.7;font-size:11px}

@media(max-width:500px){
  .bet-row{flex-wrap:wrap}
  .risk-grp{width:100%;flex-direction:row;align-items:center;gap:6px}
  .risk-grp .bet-label{width:auto}
  .risk-select{flex:1}
  .tile{width:42px;height:34px;font-size:15px}
  .lane{height:44px}
}
</style>
</head>
<body>
<div class="app">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-left">
      <div class="icon" id="infoBtn">‚ÑπÔ∏è</div>
      <div class="title">üêî Chicken Cross</div>
    </div>
    <div class="top-right">
      <button class="fair-btn" id="fairBtn">‚úì Fair Play</button>
    </div>
  </div>

  <!-- Game Area -->
  <div class="game-wrap">
    <!-- Balance -->
    <div class="bal-display" id="balDisplay"><span class="cur">$</span><span id="balAmt">5,293.00</span></div>

    <!-- Game Canvas -->
    <div class="game-canvas" id="gameCanvas">
      <div class="chicken" id="chicken">üêî</div>
      <div class="road" id="road"></div>
    </div>

    <!-- Win/Lose Overlay -->
    <div class="win-overlay" id="winOverlay">
      <div class="win-card" id="winCard">
        <div class="win-emoji" id="winEmoji">üéâ</div>
        <div class="win-text" id="winText">You Won!</div>
        <div class="win-amount" id="winAmount"></div>
        <div class="win-sub">Click to dismiss</div>
      </div>
    </div>

    <!-- Bet Controls Overlay -->
    <div class="bet-overlay">
      <div class="bet-row">
        <div class="bet-grp">
          <div class="bet-label">Bet Amount</div>
          <div class="bet-input-wrap">
            <span class="bet-cur">$</span>
            <input type="number" class="bet-input" id="betInput" value="10.00" min="0.01" step="any">
            <button class="bet-adj" id="btnHalf">¬Ω</button>
            <button class="bet-adj" id="btnDbl">2√ó</button>
          </div>
        </div>
        <div class="risk-grp">
          <div class="bet-label">Risk</div>
          <select class="risk-select" id="riskSelect">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
            <option value="expert">Expert</option>
          </select>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn-bet" id="btnBet">Bet</button>
        <button class="btn-cross" id="btnCross">Cross</button>
        <button class="btn-cashout" id="btnCashout">Cash Out</button>
      </div>
      <div class="info-row" id="infoRow" style="display:none">
        <div class="info-item">Round: <span class="info-val" id="infoRound">0/5</span></div>
        <div class="info-item">Multiplier: <span class="info-val green" id="infoMult">1.00√ó</span></div>
        <div class="info-item">Payout: <span class="info-val green" id="infoPayout">$0.00</span></div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-left">
      <div class="footer-icon" id="soundBtn">üîä</div>
      <div class="footer-icon" id="kbBtn">‚å®Ô∏è</div>
      <div class="footer-brand">Rainbet</div>
    </div>
    <div class="footer-right">
      <button class="tab on">Manual</button>
      <button class="tab">Auto</button>
    </div>
  </div>
</div>

<script>
// ===== DIFFICULTY CONFIG =====
const DIFFICULTIES = {
  easy:   { tiles: 4, dangers: 1, lanes: 5, multipliers: [1.31, 1.74, 2.32, 3.09, 4.12] },
  medium: { tiles: 3, dangers: 1, lanes: 5, multipliers: [1.47, 2.17, 3.20, 4.71, 6.94] },
  hard:   { tiles: 2, dangers: 1, lanes: 5, multipliers: [1.96, 3.84, 7.53, 14.75, 28.91] },
  expert: { tiles: 3, dangers: 2, lanes: 5, multipliers: [2.94, 8.65, 25.40, 74.67, 219.30] }
};

// ===== STATE =====
let balance = parseFloat(localStorage.getItem('cc_balance')) || 5293;
let state = 'idle'; // idle | playing | game_over
let betAmount = 0;
let currentRisk = 'medium';
let currentRound = 0;
let laneResults = [];
let cheatCharges = 0;

// ===== DOM REFS =====
const balAmt     = document.getElementById('balAmt');
const betInput   = document.getElementById('betInput');
const riskSelect = document.getElementById('riskSelect');
const btnBet     = document.getElementById('btnBet');
const btnCross   = document.getElementById('btnCross');
const btnCashout = document.getElementById('btnCashout');
const road       = document.getElementById('road');
const chicken    = document.getElementById('chicken');
const winOverlay = document.getElementById('winOverlay');
const winCard    = document.getElementById('winCard');
const winEmoji   = document.getElementById('winEmoji');
const winText    = document.getElementById('winText');
const winAmountEl= document.getElementById('winAmount');
const infoRow    = document.getElementById('infoRow');
const infoRound  = document.getElementById('infoRound');
const infoMult   = document.getElementById('infoMult');
const infoPayout = document.getElementById('infoPayout');
const fairBtn    = document.getElementById('fairBtn');

// ===== HELPERS =====
function fmt(n){ return n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}) }
function saveBalance(){ localStorage.setItem('cc_balance', balance.toFixed(2)) }
function updateBalUI(){ balAmt.textContent = fmt(balance) }

// ===== PROVABLY FAIR =====
async function hashStr(s){
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(s));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function genSeed(){ return Array.from(crypto.getRandomValues(new Uint8Array(16))).map(b=>b.toString(16).padStart(2,'0')).join('') }

let serverSeed='', clientSeed='', nonce=0;

async function isDangerTile(laneIdx, tileIdx){
  const diff = DIFFICULTIES[currentRisk];
  const hash = await hashStr(serverSeed+':'+clientSeed+':'+nonce+':'+laneIdx);
  const segment = hash.substring(tileIdx*8, tileIdx*8+8);
  const val = parseInt(segment,16);
  return (val % diff.tiles) < diff.dangers;
}

// ===== BUILD ROAD =====
function buildRoad(){
  const diff = DIFFICULTIES[currentRisk];
  road.innerHTML = '';
  for(let i = diff.lanes - 1; i >= 0; i--){
    const lane = document.createElement('div');
    lane.className = 'lane';
    lane.dataset.lane = i;

    const num = document.createElement('span');
    num.className = 'lane-num';
    num.textContent = i + 1;
    lane.appendChild(num);

    const mult = document.createElement('span');
    mult.className = 'lane-mult';
    mult.textContent = diff.multipliers[i].toFixed(2) + '√ó';
    lane.appendChild(mult);

    const tilesDiv = document.createElement('div');
    tilesDiv.className = 'tiles';
    for(let t = 0; t < diff.tiles; t++){
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.lane = i;
      tile.dataset.tile = t;
      tilesDiv.appendChild(tile);
    }
    lane.appendChild(tilesDiv);
    road.appendChild(lane);
  }
}

// ===== UPDATE LANE STATES =====
function updateLanes(){
  const diff = DIFFICULTIES[currentRisk];
  const lanes = road.querySelectorAll('.lane');
  lanes.forEach(lane => {
    const idx = parseInt(lane.dataset.lane);
    lane.classList.remove('active','cleared','dead');
    const tiles = lane.querySelectorAll('.tile');
    tiles.forEach(t => {
      t.classList.remove('safe','danger','pothole','revealed');
      t.onclick = null;
    });

    if(state === 'playing'){
      if(idx < currentRound){
        lane.classList.add('cleared');
        const result = laneResults[idx];
        if(result){
          tiles.forEach((t, ti) => {
            if(ti === result.picked) t.classList.add('safe');
            else t.classList.add('revealed');
          });
        }
      } else if(idx === currentRound){
        lane.classList.add('active');
        tiles.forEach(t => {
          t.onclick = () => pickTile(idx, parseInt(t.dataset.tile));
        });
      }
    } else if(state === 'game_over'){
      const result = laneResults[idx];
      if(result){
        lane.classList.add(result.safe ? 'cleared' : 'dead');
        tiles.forEach((t, ti) => {
          if(ti === result.picked){
            t.classList.add(result.safe ? 'safe' : 'pothole');
          } else if(result.dangerTiles && result.dangerTiles.includes(ti)){
            t.classList.add('danger');
          } else {
            t.classList.add('revealed');
          }
        });
      }
    }
  });
}

// ===== MOVE CHICKEN =====
function moveChicken(){
  if(currentRound === 0){
    chicken.style.transform = 'translateY(0)';
  } else {
    const laneHeight = 54;
    chicken.style.transform = `translateY(-${currentRound * laneHeight}px)`;
  }
}

// ===== PICK A TILE =====
async function pickTile(laneIdx, tileIdx){
  if(state !== 'playing' || laneIdx !== currentRound) return;

  const diff = DIFFICULTIES[currentRisk];

  // Determine all danger tiles for this lane
  let dangerTiles = [];
  for(let t = 0; t < diff.tiles; t++){
    if(await isDangerTile(laneIdx, t)) dangerTiles.push(t);
  }
  // Ensure at least one safe tile exists
  if(dangerTiles.length >= diff.tiles){
    dangerTiles = dangerTiles.slice(0, diff.tiles - 1);
  }

  let safe = !dangerTiles.includes(tileIdx);

  // Cheat: if unsafe and charges available, force safe
  if(!safe && cheatCharges > 0){
    safe = true;
    cheatCharges--;
  }

  laneResults[laneIdx] = { picked: tileIdx, safe, dangerTiles };

  if(safe){
    currentRound++;
    updateLanes();
    moveChicken();
    updateInfo();
    updateButtons();

    if(currentRound >= diff.lanes){
      const mult = diff.multipliers[diff.lanes - 1];
      const payout = betAmount * mult;
      balance += payout;
      saveBalance();
      updateBalUI();
      state = 'game_over';
      updateButtons();
      updateLanes();
      showResult(true, payout, mult);
    }
  } else {
    chicken.classList.add('dead');
    state = 'game_over';
    updateLanes();
    updateButtons();
    setTimeout(() => showResult(false, betAmount, 0), 500);
  }
}

// ===== CASH OUT =====
function cashOut(){
  if(state !== 'playing' || currentRound === 0) return;
  const diff = DIFFICULTIES[currentRisk];
  const mult = diff.multipliers[currentRound - 1];
  const payout = betAmount * mult;
  balance += payout;
  saveBalance();
  updateBalUI();
  state = 'game_over';
  updateButtons();
  updateLanes();
  showResult(true, payout, mult);
}

// ===== START GAME =====
function startGame(){
  betAmount = parseFloat(betInput.value) || 0;
  if(betAmount <= 0){ betInput.focus(); return; }
  if(betAmount > balance){ betAmount = balance; betInput.value = betAmount.toFixed(2); }
  if(betAmount <= 0) return;

  balance -= betAmount;
  saveBalance();
  updateBalUI();

  state = 'playing';
  currentRound = 0;
  currentRisk = riskSelect.value;
  laneResults = [];
  serverSeed = genSeed();
  clientSeed = genSeed();
  nonce = Math.floor(Math.random() * 1000000);

  chicken.classList.remove('dead');
  chicken.style.transform = 'translateY(0)';
  winOverlay.classList.remove('show');

  buildRoad();
  updateLanes();
  updateButtons();
  updateInfo();

  betInput.disabled = true;
  riskSelect.disabled = true;
}

// ===== UI UPDATES =====
function updateButtons(){
  if(state === 'idle' || state === 'game_over'){
    btnBet.style.display = '';
    btnCross.style.display = 'none';
    btnCashout.style.display = 'none';
    btnBet.disabled = false;
    betInput.disabled = false;
    riskSelect.disabled = false;
  } else if(state === 'playing'){
    btnBet.style.display = 'none';
    if(currentRound > 0){
      btnCross.style.display = 'none';
      btnCashout.style.display = '';
      const diff = DIFFICULTIES[currentRisk];
      const mult = diff.multipliers[currentRound - 1];
      btnCashout.textContent = 'Cash Out $' + fmt(betAmount * mult);
    } else {
      btnCross.style.display = '';
      btnCross.textContent = 'Pick a lane ‚òùÔ∏è';
      btnCross.disabled = true;
      btnCashout.style.display = 'none';
    }
  }
}

function updateInfo(){
  if(state === 'playing'){
    infoRow.style.display = '';
    const diff = DIFFICULTIES[currentRisk];
    infoRound.textContent = currentRound + '/' + diff.lanes;
    if(currentRound > 0){
      const mult = diff.multipliers[currentRound - 1];
      infoMult.textContent = mult.toFixed(2) + '√ó';
      infoPayout.textContent = '$' + fmt(betAmount * mult);
    } else {
      infoMult.textContent = '1.00√ó';
      infoPayout.textContent = '$' + fmt(betAmount);
    }
  } else {
    infoRow.style.display = 'none';
  }
}

function showResult(won, amount, mult){
  winOverlay.classList.add('show');
  if(won){
    winCard.className = 'win-card';
    winEmoji.textContent = 'üéâ';
    winText.textContent = 'You Won!';
    winAmountEl.textContent = '$' + fmt(amount) + (mult ? ' (' + mult.toFixed(2) + '√ó)' : '');
  } else {
    winCard.className = 'win-card lose';
    winEmoji.textContent = 'üíÄ';
    winText.textContent = 'You Died!';
    winAmountEl.textContent = '-$' + fmt(amount);
  }
}

// ===== CHEAT (Fair Play button) =====
fairBtn.addEventListener('click', () => {
  cheatCharges++;
  fairBtn.style.borderColor = '#7DD934';
  fairBtn.style.color = '#7DD934';
  setTimeout(() => {
    fairBtn.style.borderColor = '';
    fairBtn.style.color = '';
  }, 200);
});

// ===== EVENT LISTENERS =====
btnBet.addEventListener('click', startGame);
btnCashout.addEventListener('click', cashOut);

winOverlay.addEventListener('click', () => winOverlay.classList.remove('show'));

document.getElementById('btnHalf').addEventListener('click', () => {
  if(state === 'playing') return;
  betInput.value = Math.max(0.01, (parseFloat(betInput.value)||0) / 2).toFixed(2);
});

document.getElementById('btnDbl').addEventListener('click', () => {
  if(state === 'playing') return;
  betInput.value = Math.min(balance, (parseFloat(betInput.value)||0) * 2).toFixed(2);
});

riskSelect.addEventListener('change', () => {
  if(state === 'playing') return;
  currentRisk = riskSelect.value;
  buildRoad();
});

document.getElementById('balDisplay').addEventListener('click', () => {
  if(state === 'playing') return;
  if(confirm('Reset balance to $5,293.00?')){
    balance = 5293;
    saveBalance();
    updateBalUI();
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', e => {
  if(document.activeElement === betInput && e.key !== 'Enter') return;
  if(e.key === 'Enter' || e.key === ' '){
    e.preventDefault();
    if(state === 'idle' || state === 'game_over') startGame();
    else if(state === 'playing' && currentRound > 0) cashOut();
  }
});

// Sound toggle
let soundOn = true;
document.getElementById('soundBtn').addEventListener('click', function(){
  soundOn = !soundOn;
  this.textContent = soundOn ? 'üîä' : 'üîá';
});

// ===== INIT =====
updateBalUI();
buildRoad();
updateButtons();
</script>
</body>
</html>
